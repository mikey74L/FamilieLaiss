/**
 * Copyright (c) 2023 The Nuevodevel Team. All rights reserved.
 * Vroll plugin for video.js
 * Version 1.4.0
 */
!function(e,t){if("undefined"!=typeof window&&window.videojs)t(window.videojs);else if("function"==typeof define&&define.amd)define("vroll",["video.js"],function(e){return t(e.default||e)});else if("undefined"!=typeof module&&module.exports){var r=require("video.js");module.exports=t(r.default||r)}}(0,function(e){function t(t,r,n){var o=null;n&&n.trackUrl&&(o=n.trackUrl);var i,l=[],a=!1,s=!1,d=!1,u=!1,f=!1,c=!1,v=!1,p="undefined",m=-1,y=0,h=0,g=t.$(".vjs-tech");e.isAd=!1;var k,b=e.dom,j=t.el(),T=.1,C=e.browser,S=null,A=null,x=[],_=null,O=null,q=null,I=null;function w(e){return e}function P(e){return"[object Array]"===Object.prototype.toString.call(e)}e.vrollplugin=!0;var E=function(e,t){var r=document.createElement(e);return void 0!==t&&""!==t&&(r.className=t),r},N=function(e){return t.localize(e)};function M(){return t.duration()===1/0||"8"===C.IOS_VERSION&&0===t.duration()}var H=!0;if(!P(r)){var L=r;if(L.src&&L.src.length>5){if(L.offset)L.offset.indexOf("%")>-1&&M()&&(H=!1);else L.offset=0;H&&((r=[])[0]=L)}}if(P(r))for(var B=0,F=0;F<r.length;F++){var Q=r[F];if(Q.src&&"undefined"!==Q.offset){Q.loaded=!1,B=0;try{B=l[F].offset.indexOf("%")}catch(e){w(e)}B>0&&M()?B=1:l.push(Q)}}t.ready(function(){O=t.el_.querySelector(".vjs-loading-spinner");var r=t.el_.querySelector(".vjs-big-play-button");if(A=t.el_.querySelector(".vjs-replay-button"),l.length>0){i=E("a","vast-blocker vjs-hidden"),t.el_.appendChild(i);var n=function(e){var t=e.el().querySelector(".vjs-tech"),r={ended:e.ended(),src:e.currentSrc(),currentTime:e.currentTime(),type:e.currentType(),currentSource:e.currentSource(),playing:!e.paused(),suppressedTracks:C(e)};return r.ended&&(r.currentTime=e.duration()),t&&(r.style=t.getAttribute("style")),r},C=function(e){var t=e.remoteTextTracks?e.remoteTextTracks():[];t&&P(t.tracks_)&&(t=t.tracks_),P(t)||(t=[]);var r=[];return t.forEach(function(e){r.push({track:e,mode:e.mode}),e.mode="disabled"}),r},H=function(){q.suppressedTracks.forEach(function(e){e.track.mode=e.mode})},L=function(e){var t=e.el().querySelector(".vjs-tech");"style"in q&&t.setAttribute("style",q.style||""),e.one("contentloadedmetadata",H);t.poster="",e.src(q.currentSource),e.load(),H(),M()?B():(B(),e.currentTime(q.currentTime))},B=function(){var e=t.play();void 0!==e&&e.then(function(){}).catch(function(){t.muted(!0),t.play()})};t.vroll.reset=function(){f=!1,d=!1,b.removeClass(j,"vjs-ad-playing"),t.one("playing",function(){for(var e=0;e<l.length;e++)l[e].loaded=!1})},0===parseInt(l[0].offset,10)&&(t.offline?t.isPreroll=!1:(t.isPreroll=!0,!0!==v&&(v=!0,h=t.volume(),t.volume(0)),t.one("play",function(){if(t.isPreroll){var e=t.el_.querySelector(".vjs-poster");S=E("div","vjs-black-poster"),j.insertBefore(S,e.nextSibling),t.isPreroll=!1}}))),t.on("loadedmetadata",function(){if(t.isOffline)f=!1;else if(!f){f=!0;var C=t.duration();if(l.length>0&&!0!==u){u=!0;for(var P=0;P<l.length;P++){l[P].method="";var H=0;try{H=l[P].offset.indexOf("%",0)}catch(e){w(e)}if(H>0){var B=parseInt(l[P].offset,10);100===B||"end"===l[P].offset?(l[P].method="postroll",l[P].offset="end",x.push(l[P])):l[P].offset=C*(B/100)}else l[P].offset=parseInt(l[P].offset,10)}}if(l.length>0){t.on("timeupdate",function r(){l[l.length-1].loaded&&t.off("timeupdate",r);var n=e.dom.hasClass(j,"vjs-has-started");var o=M();n&&!0!==s&&!0!==t.isOffline&&!0!==o&&V(t.currentTime())});var F=function(){s?(clearTimeout(y),c=!1):(V(T+=.5),y=setTimeout(F,500))};M()&&(t.on("pause",function(){clearTimeout(y),c=!1}),t.on("playing",function(){e.dom.hasClass(j,"vjs-has-started")&&!0!==a&&l.length>0&&!0!==t.isOffline&&!0!==c&&(c=!0,y=setTimeout(F,500))}));var Q=function(e){if(a)return t.trigger("vroll",{id:p.id,action:"completed"}),X("completed"),void G();if(null!==x){q||(q=n(t)),O.setAttribute("style","display:none !important");for(var r=0;r<x.length;r++)if(!0!==x[r].loaded)return t.trigger("vroll",{id:p.id,action:"completed"}),X("completed"),q||(q=n(t)),void U()}t.trigger("vroll",{id:p.id,action:"completed"}),X("completed"),z(!0),t.off("ended",Q),setTimeout(function(){b.removeClass(A,"vjs-hidden")},500),check_playlist()};check_playlist=function(){t.playlist&&t.playlist.length>0&&(t.pause(),t.playlist.next(!0))},t.on("ended",Q),t.one("play",function(){b.addClass(A,"vjs-hidden")});var U=function(){for(var e=0;e<x.length;e++)if(!0!==x[e].loaded)return void D(x[e]);z(),L(t,q)};function z(r){t.off("timeupdate",te),t.off("error",ee),r&&(x=null,Y(".vast-blocker")),a=!1,d=!1,s=!1,Y(".vast-skip-button"),setTimeout(function(){O.removeAttribute("style")},500),b.addClass(j,"vjs-has-started"),g.poster="",b.removeClass(j,"vjs-ad-playing"),e.isAd=!1}var D=function(r){r.loaded=!0,p=r,s=!0,e.isAd=!0,b.addClass(j,"vjs-ad-playing"),d=!0,t.on("error",ee);var n={src:r.src,type:r.type};t.src(n),O.setAttribute("style","display:none !important"),t.play(),t.one("play",function(){re()})},R=function(e,r){a=!0,e.loaded=!0,p=e,d=!0;var o={src:e.src,type:e.type};if(q||(q=n(t)),O.setAttribute("style","display:none !important"),t.one("error",ee),t.src(o),t.currentTime(0),t.paused()){var i=!1;t.el_.className.indexOf("vjs-has-started")>0&&(i=!0),(t.ended()||i)&&t.play(),t.ended()&&t.play(),t.one("play",function(){re()})}else{re();var l=t.play();void 0!==l&&l.then(function(){}).catch(function(e){})}};t.isPreroll&&(!0!==v&&(v=!0,h=t.volume(),t.volume(0)),!0!==M()&&R(l[0]));var V=function(r){if(!a&&!s){var n=r;null==I&&(I=t.muted()),n>0&&t.el_.querySelector(".vjs-poster").removeAttribute("style");for(var o=0;o<l.length;o++){var i=l[o];n>=i.offset&&!0!==a&&!0!==l[o].loaded&&(e.log.level("off"),R(i))}}};i.onclick=function(){t.trigger("vroll",{id:p.id,action:"clicked"}),X("click")};var $=function(){return t.paused()};function G(){Y(".vast-skip-button"),_=null,m=-1;var r=p.offset;p.loaded=!0,t.isPreroll=!1;var n=!1;b.addClass(j,"vjs-has-started");for(var o=0;o<l.length&&(l[o].offset===r&&!0!==l[o].loaded&&(t.off("timeupdate",te),t.off("error",ee),a=!0,s=!0,l[o].loaded=!0,e.isAd=!0,b.addClass(j,"vjs-ad-playing"),d=!0,R(l[o],!0),n=!0),!n);o++);if(!0!==n){var i=!0;for(o=0;o<l.length;o++)!0!==l[o].loaded&&(i=!1);t.off("timeupdate",te),t.off("error",ee),z(i),L(t,q),q=null}}var J,K,W=!1;function X(e,t){if(o){var r=new Image,n="?event="+e;p.id&&(n=n+"&id="+p.id),r.src=o+n}}function Y(e){var r=t.el_.querySelectorAll(e);if(r)for(var n=0;n<r.length;n++)r[n].parentNode.removeChild(r[n])}function Z(){Y(".vast-skip-button"),(_=E("div","vast-skip-button vjs-hidden")).id="adSkipButton",_.ariaDisabled="false",_.tabIndex="0",k=E("p","vast-skip-button-text"),_.appendChild(k),t.el_.appendChild(_),_.onclick=function(e){!function(e){e.stopPropagation(),(" "+_.className+" ").indexOf(" enabled ")>=0&&(t.trigger("vroll",{id:p.id,action:"skipped"}),X("skipped"),"postroll"===p.method?U():G())}(e)}}function ee(){a&&(t.trigger("vroll",{id:p.id,action:"error"}),X("error"),"postroll"===p.method?U():G(),d=!1)}function te(){$()||function(e){e=t.currentTime();var r=t.duration();if(r>0){var n=((r=r.toFixed(0))/4).toFixed(0);if(e>n&&!0!==J&&(X("fistQuartile"),J=!0),e>2*n&&!0!==K&&(X("midpoint"),K=!0),e>3*n&&!0!==W&&(X("thirdQuartile"),W=!0),m>-1){var o=Math.ceil(m-e);if(b.removeClass(_,"vjs-hidden"),o>0){var i=N("Skip Ad in %%TIME%%");_.innerHTML="",E("p","vast-skip-button-text"),_.appendChild(k),k.innerHTML=i.replace("%%TIME%%",o)}else _.className="vast-skip-button enabled",_.innerHTML=N("Skip Ad")}}}(t.currentTime(),t.duration())}function re(){t.currentTime(0),t.on("timeupdate",te),p.offset>0&&b.addClass(r,"vjs-hidden"),(m=p.skip>=0?parseInt(p.skip,10):-1)>-1&&Z(),b.addClass(j,"vjs-ad-playing"),b.addClass(r,"vjs-hidden"),S&&(j.removeChild(S),S=null,t.volume(h)),t.el_.querySelector(".vjs-poster").removeAttribute("style"),i.className="vast-blocker",void 0!==p.href?(i.removeAttribute("style"),i.href=p.href,i.target="_blank"):i.style.pointerEvents="none",s=!0,d&&(t.trigger("vroll",{id:p.id,action:"start"}),X("adstart"),d=!1)}}}})}})}((e=e&&e.hasOwnProperty("default")?e.default:e).registerPlugin||e.plugin)("vroll",function(e,r){this.ready(function(){t(this,e,r)})})});
